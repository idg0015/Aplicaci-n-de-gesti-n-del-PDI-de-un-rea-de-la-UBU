\apendice{Especificación de diseño}

\section{Introducción}
Una vez realizado el estudio y especificación de los requisitos de la aplicación web, se debe realizar el diseño de la misma. En este anexo se pretende aportar información sobre el diseño de los datos que utiliza la aplicación junto al diseño procedimental y arquitectónico del proyecto.

\section{Diseño de datos}
Gracias a la especificación de requisitos y casos de uso, se puede obtener una visión global de la aplicación que permite deducir las entidades, acompañadas de sus datos, necesarias para poder cumplir con lo requerido.

En primer lugar, podemos obtener la visión global de las entidades relacionadas mediante el diagrama general de Entidad-Relación de la figura~\ref{DiagramaGeneralE-R}.

El diagrama obtenido tiene un gran tamaño y, para mejorar la visualización y comprensión del mismo, se ha decidido dividir en vistas donde se incluyan los datos de cada una de las entidades.

La primera vista hace referencia al apartado de mantenimiento académico y se puede ver en la figura~\ref{er_cu1}, la segunda al mantenimiento de profesorado~\ref{er_cu2} y la última a la asignación docente~\ref{er_cu3}.


\figuraApaisadaSinMarco{}{../img/Anexos/Diagrama E-R.pdf}{Diagrama general entidad-relación}{DiagramaGeneralE-R}{}

Del diagrama entidad-relación se puede obtener el diagrama relacional de la figura~\ref{DiagramaRelacional} en el que se pueden ver la tablas que contendrá la base de datos de la aplicación web.

En este diagrama se pueden ver las tablas de la base de datos juntos los distintos campos que tendrá cada una.
Como se puede ver en la figura~\ref{DiagramaRelacional}, las tablas centro, titulación y asignatura tienen un campo llamado código. 
Este código campo podría haber sido utilizado como clave primaria, pero al ser un campo que introduce el usuario, se decidió mantener una clave primaria auto-incremental con la que se hacen las relaciones de las tablas, y además, añadir ese campo para que se puedan hacer búsquedas o filtrar por el mismo sin que su uso pueda afectar a la consistencia del sistema.

Otro aspecto relevante es que en las relaciones que dan lugar a la creación de una tabla intermedia se siguió el mismo patrón que antes. 
Aunque la teoría diga que las claves de las tablas que se relacionan pasan a ser claves primarias de la nueva tabla que se genera, se decidió tener una única clave primaria auto-incremental y tener las claves de las tablas relacionadas como claves foráneas.
De esta manera, las búsquedas en la base de datos estarán más optimizadas al buscar como clave primaria un único campo y no la composición de varios.
Además, se evita cualquier tipo de error de clave primaria al ser la propia base de datos la que asigna esta y no el código creado.

\figuraApaisadaSinMarco{}{../img/Anexos/Diagrama relacional.pdf}{Diagrama relacional}{DiagramaRelacional}{}

\subsection{Diccionario de datos}
A continuación se va a especificar, para cada tabla de la base de datos, el diccionario de datos correspondiente.
De esta forma se pretende facilitar la comprensión de los datos almacenados en la base de datos.

La tabla \texttt{centro} almacena los diferentes centros de la universidad. 
Se puede ver su información en la tabla~\ref{tab:diccionario_centro}.
\begin{table}
\centering
  \begin{tabular}{l p{.2\textwidth} p{.5\textwidth}}
    \toprule
    \textbf{Campo} & \textbf{Tipo} & \textbf{Descripción}\\
    \midrule
    \textbf{\underline{id}} & Entero \underline{PK} & Identificador. Clave primaria creada de forma autoincremental. \\ \addlinespace
    codigo & Entero & Código interno del centro de la universidad. Sólo tiene carácter informativo. \\ \addlinespace 
    abreviatura & Texto & Abreviatura del centro. \\ \addlinespace
    email & Texto & Email administrativo del centro. \\
    \bottomrule
  \end{tabular}
  \caption{Diccionario de datos. Tabla Centro}
  \label{tab:diccionario_centro}
\end{table}

La tabla \texttt{titulación} almacena las titulaciones que son creadas y que pertenecen a un centro.
Se puede ver su información en la tabla~\ref{tab:diccionario_titulacion}.
\begin{table}
  \centering 
  \begin{tabular}{l p{.2\textwidth} p{.5\textwidth}}
    \toprule
    \textbf{Campo} & \textbf{Tipo} & \textbf{Descripción}\\
    \midrule
    \textbf{\underline{id}} & Entero \underline{PK} & Identificador de la titulación. Clave primaria creada de forma autoincremental. \\ \addlinespace
    codigo & Entero & Código interno de la titulación. \\ \addlinespace
    nombre & Texto & Nombre de la titulación. \\ \addlinespace
    abreviatura & Texto & Abreviatura de la titulación. \\ \addlinespace
    url & Texto & Dirección web de la titulación. \\ \addlinespace
    id\_centro & Entero FK(Centro) & Identificador del centro asociado a la titulación. \\
    \bottomrule
  \end{tabular}
  \caption{Diccionario de datos. Tabla Titulación}
  \label{tab:diccionario_titulacion}
\end{table}

La tabla \texttt{asignatura} almacena información sobre las asignaturas, cada asignatura pertenece a una titulación. Se puede ver su información en la tabla~\ref{tab:diccionario_asignatura}.

\begin{table}
  \centering 
  \begin{tabular}{l p{.2\textwidth} p{.5\textwidth}}
    \toprule
    \textbf{Campo} & \textbf{Tipo} & \textbf{Descripción}\\
    \midrule
    \textbf{\underline{id}} & Entero \underline{PK} & Identificador de la asignatura. Clave primaria creada de forma autoincremental. \\ \addlinespace
    codigo & Entero & Código interno de la asignatura. \\ \addlinespace
    nombre & Texto & Nombre de la asignatura. \\ \addlinespace
    tipo & Texto & Tipo de la asignatura. \\ \addlinespace
    creditos\_teoria & Entero & Créditos de teoría de la asignatura. \\ \addlinespace
    creditos\_practica & Entero & Créditos de práctica de la asignatura. \\ \addlinespace
    curso & Texto & Curso al que pertenece la asignatura. \\ \addlinespace
    semestre & Texto & Semestre en el que se imparte la asignatura. \\ \addlinespace
    id\_titulacion & Entero FK(Titulación) & Identificador de la titulación a la que pertenece la asignatura. \\
    \bottomrule
  \end{tabular}
  \caption{Diccionario de datos. Tabla Asignatura}
  \label{tab:diccionario_asignatura}
\end{table}

La tabla \texttt{abreviatura} almacena las abreviaturas de las asignaturas. 
De esta forma se permite que una asignatura pueda tener varias abreviaturas.
Se puede ver su información en la tabla~\ref{tab:diccionario_abreviatura}.

\begin{table}
  \centering 
  \begin{tabular}{l p{.2\textwidth} p{.5\textwidth}}
    \toprule
    \textbf{Campo} & \textbf{Tipo} & \textbf{Descripción}\\
    \midrule
    \textbf{\underline{id}} & Entero \underline{PK} & Identificador de la abreviatura. Clave primaria creada de forma autoincremental. \\ \addlinespace
    abreviatura & Texto & Abreviatura de la asignatura. \\ \addlinespace
    id\_asignatura & Entero FK(Asignatura) & Identificador de la asignatura asociada a la abreviatura. \\
    \bottomrule
  \end{tabular}
  \caption{Diccionario de datos. Tabla Abreviatura}
  \label{tab:diccionario_abreviatura}
\end{table}

La tabla \texttt{curso} almacena información sobre los cursos. Se puede ver su información en la tabla~\ref{tab:diccionario_curso}.

\begin{table}
  \centering 
  \begin{tabular}{l p{.2\textwidth} p{.5\textwidth}}
    \toprule
    \textbf{Campo} & \textbf{Tipo} & \textbf{Descripción}\\
    \midrule
    \textbf{\underline{id}} & Entero \underline{PK} & Identificador del curso. Clave primaria creada de forma autoincremental. \\ \addlinespace
    ano\_inicio & Texto & Año de inicio del curso. \\ \addlinespace
    \bottomrule
  \end{tabular}
  \caption{Diccionario de datos. Tabla Curso}
  \label{tab:diccionario_curso}
\end{table}

La tabla \texttt{curso\_asignatura} almacena la relación entre cursos y asignaturas. 
Se puede ver su información en la tabla~\ref{tab:diccionario_curso_asignatura}.

\begin{table}
  \centering
  \begin{tabular}{l p{.2\textwidth} p{.25\textwidth}}
    \toprule
    \textbf{Campo} & \textbf{Tipo} & \textbf{Descripción}\\
    \midrule
    \textbf{\underline{id}} & Entero \underline{PK} & Identificador de la relación curso-asignatura. Clave primaria creada de forma autoincremental. \\ \addlinespace
    id\_asignatura & Entero FK(Asignatura) & Identificador de la asignatura relacionada. \\ \addlinespace
    id\_curso & Entero FK(Curso) & Identificador del curso relacionado. \\ \addlinespace
    modalidad & Texto & Modalidad de la relación curso-asignatura. \\ \addlinespace
    num\_alumnos\_previstos & Entero & Número de alumnos previstos para la relación curso-asignatura. \\ \addlinespace
    num\_grupos\_teoricos\_previstos & Entero & Número de grupos teóricos previstos para la relación curso-asignatura. \\ \addlinespace
    num\_grupos\_practicos\_previstos & Entero & Número de grupos prácticos previstos para la relación curso-asignatura. \\
    \bottomrule
  \end{tabular}
  \caption{Diccionario de datos. Tabla Curso-Asignatura}
  \label{tab:diccionario_curso_asignatura}
\end{table}

La tabla \texttt{grupo} almacena información sobre los grupos de asignaturas. 
Se puede ver su información en la tabla~\ref{tab:diccionario_grupo}.

\begin{table}
  \centering 
  \begin{tabular}{l p{.2\textwidth} p{.4\textwidth}}
    \toprule
    \textbf{Campo} & \textbf{Tipo} & \textbf{Descripción}\\
    \midrule
    \textbf{\underline{id}} & Entero \underline{PK} & Identificador del grupo. Clave primaria creada de forma autoincremental. \\ \addlinespace
    nombre & Texto & Nombre del grupo. \\ \addlinespace
    tipo & Texto & Tipo de grupo. \\ \addlinespace
    id\_curso\_asignatura & Entero FK(Curso-Asignatura) & Identificador de la relación curso-asignatura asociada al grupo. \\
    \bottomrule
  \end{tabular}
  \caption{Diccionario de datos. Tabla Grupo}
  \label{tab:diccionario_grupo}
\end{table}

La tabla \texttt{docente} almacena información sobre los docentes. Se puede ver su información en la tabla~\ref{tab:diccionario_docente}.

\begin{table}
  \centering 
  \begin{tabular}{l p{.2\textwidth} p{.5\textwidth}}
    \toprule
    \textbf{Campo} & \textbf{Tipo} & \textbf{Descripción}\\
    \midrule
    \textbf{\underline{id}} & Entero \underline{PK} & Identificador del docente. Clave primaria generada de forma autoincremental. \\ \addlinespace
    nombre & Texto & Nombre del docente. \\ \addlinespace
    apellidos & Texto & Apellidos del docente. \\ \addlinespace
    email & Texto & Email del docente \\ \addlinespace
    reducciones & Entero & Número de horas de reducciones del docente. \\
    \bottomrule
  \end{tabular}
  \caption{Diccionario de datos. Tabla Docente}
  \label{tab:diccionario_docente}
\end{table}

La tabla \texttt{departamento} almacena información sobre los departamentos de la universidad. 
Se puede ver su información en la tabla~\ref{tab:diccionario_departamento}.

\begin{table}
  \centering 
  \begin{tabular}{l p{.2\textwidth} p{.5\textwidth}}
    \toprule
    \textbf{Campo} & \textbf{Tipo} & \textbf{Descripción}\\
    \midrule
    \textbf{\underline{id}} & Entero \underline{PK} & Identificador del departamento. Clave primaria generada de forma autoincremental. \\ \addlinespace
    nombre & Texto & Nombre del departamento. \\ \addlinespace
    abreviatura & Texto & Abreviatura del departamento. \\
    \bottomrule
  \end{tabular}
  \caption{Diccionario de datos. Tabla Departamento}
  \label{tab:diccionario_departamento}
\end{table}

La tabla \texttt{área} almacena información sobre las áreas de un departamento. 
Se puede ver su información en la tabla~\ref{tab:diccionario_area}.

\begin{table}
  \centering 
  \begin{tabular}{l p{.3\textwidth} p{.4\textwidth}}
    \toprule
    \textbf{Campo} & \textbf{Tipo} & \textbf{Descripción}\\
    \midrule
    \textbf{\underline{id}} & Entero \underline{PK} & Identificador del área. Clave primaria creada de forma autoincremental. \\ \addlinespace
    nombre & Texto & Nombre del área. \\ \addlinespace
    abreviatura & Texto & Abreviatura del área. \\ \addlinespace
    id\_departamento & Entero FK(Departamento) & Identificador del departamento al que pertenece el área. \\
    \bottomrule
  \end{tabular}
  \caption{Diccionario de datos. Tabla Área}
  \label{tab:diccionario_area}
\end{table}

La tabla \texttt{contrato} almacena información sobre los tipos de contratos. 
Se puede ver su información en la tabla~\ref{tab:diccionario_tipo_contrato}.

\begin{table}
  \centering 
  \begin{tabular}{l p{.2\textwidth} p{.5\textwidth}}
    \toprule
    \textbf{Campo} & \textbf{Tipo} & \textbf{Descripción}\\
    \midrule
    \textbf{\underline{id}} & Entero \underline{PK} & Identificador del tipo de contrato. Clave primaria generada de forma autoincremental. \\ \addlinespace
    nombre & Texto & Nombre del tipo de contrato. \\ \addlinespace
    abreviatura & Texto & Abreviatura del tipo de contrato. \\ \addlinespace
    capacidad\_anual & Entero & Capacidad anual en horas del tipo de contrato. \\
    \bottomrule
  \end{tabular}
  \caption{Diccionario de datos. Tabla Tipo Contrato}
  \label{tab:diccionario_tipo_contrato}
\end{table}

La tabla \texttt{plaza} almacena información sobre las plazas de contratación. 
Se puede ver su información en la tabla~\ref{tab:diccionario_plaza}.

\begin{table}
  \centering 
  \begin{tabular}{l p{.2\textwidth} p{.35\textwidth}}
    \toprule
    \textbf{Campo} & \textbf{Tipo} & \textbf{Descripción}\\
    \midrule
    \textbf{\underline{id}} & Entero \underline{PK} & Identificador de la plaza. Clave primaria generada de forma autoincremental \\ \addlinespace
    nombre & Texto & Nombre de la plaza \\ \addlinespace
    rpt & Texto & RPT de la plaza \\ \addlinespace
    num\_concursos\_contratacion & Entero & Número de concursos de contratación de la plaza \\ \addlinespace
    fecha\_incorporacion & Fecha & Fecha de incorporación a la plaza. \\ \addlinespace
    fecha\_cese & Fecha & Fecha de cese de la plaza. \\ \addlinespace
    id\_docente & Entero & Identificador del docente asignado a la plaza. \\ \addlinespace
    id\_area & Entero & Identificador del área asociada a la plaza. \\ \addlinespace
    id\_contrato & Entero & Identificador del tipo de contrato asociado a la plaza. \\
    \bottomrule
  \end{tabular}
  \caption{Diccionario de datos. Tabla Plaza}
  \label{tab:diccionario_plaza}
\end{table}

La tabla \texttt{plaza-grupo} almacena información sobre la asignación de horas de plazas a grupos. 
Se puede ver su información en la tabla~\ref{tab:diccionario_plaza_grupo}.

\begin{table}
  \centering 
  \begin{tabular}{l p{.2\textwidth} p{.5\textwidth}}
    \toprule
    \textbf{Campo} & \textbf{Tipo} & \textbf{Descripción}\\
    \midrule
    \textbf{\underline{id}} & Entero \underline{PK} & Identificador de la asignación. Clave primaria generada de forma autoincremental. \\ \addlinespace
    horas & Entero & Horas de la plaza asignadas al grupo. \\ \addlinespace
    id\_grupo & Entero & Identificador del grupo. \\ \addlinespace
    id\_plaza & Entero & Identificador de la plaza. \\
    \bottomrule
  \end{tabular}
  \caption{Diccionario de datos. Tabla Plaza-Grupo}
  \label{tab:diccionario_plaza_grupo}
\end{table}

Existen otras dos tablas llamadas \texttt{alemic\_version} y \texttt{sessions} que son creadas por algunas de las bibliotecas que se utilizan en la aplicación. 
La primera guarda un registro de las migraciones de la base de datos y la segunda almacena la sesión de los usuarios.

\section{Diseño procedimental}
El diseño procedimental es una fase fundamental en el desarrollo de proyectos informáticos, donde se establecen los pasos necesarios para realizar una actividad dentro de la aplicación.

\begin{itemize}
\item \textbf{Creación de centro}

El diagrama~\ref{DS-crearCentro} muestra los pasos necesarios para crear un nuevo centro en la aplicación web.

Se parte de que el usuario está en la ventana de centros.
Desde ahí el usuario debe pulsar en <<Nuevo>>, lo que provocará la redirección a la ventana que contiene el formulario de creación.
El usuario debe rellenar el formulario y pulsar sobre <<Añadir>>.

Al hacer esto los datos se mandan al servidor.
Si todo está correcto el nuevo centro se almacena en la base de datos, mientras que si hay algún error en los datos introducidos, se recarga la página del formulario indicando los errores de cada campo.

El método \texttt{save} se encarga de comprobar si el objeto centro tiene identificador, ya que si no tiene, se trata de un objeto no almacenado en la base de datos y debe llamar al método \texttt{add} para guardarlo, mientras que si ya tiene id, quiere decir que se trata de una modificación y tan sólo debe hacer el \textit{commit} para guardar los datos modificados.

Una vez se ha guardado el nuevo centro, la aplicación redirecciona al usuario a la página de centros.

El diagrama~\ref{DS-crearCentro} se va a utilizar como ejemplo de creación para las tablas de <<Titulación>>, <<Asignatura>>, <<Docente>>, <<Plaza>>, <<Contrato>>, <<Área>> y <<Departamento>>.
Esto es debido a que la creación en estas tablas es igual y sólo cambia el nombre de los modelos, controladores y rutas, pero el funcionamiento es el mismo.

\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{../img/Anexos/Diagramas secuencia/DS - crear centro.pdf}
	\caption{\textit{Diagrama de secuencia referente a la creación de centros.}}\label{DS-crearCentro}
\end{figure}

\item \textbf{Modificación de centro}

En el diagrama~\ref{DS-modificarCentro} se muestra el proceso seguido para modificar un centro.
Se parte de la base de que el centro ya se encuentra creado.
Al igual que en el caso anterior, este diagrama sirve de ejemplo para la modificación de <<Titulación>>, <<Asignatura>>, <<Docente>>, <<Plaza>>, <<Contrato>>, <<Área>> y <<Departamento>>.

Suponiendo que el usuario se encuentra en la ventana de centros y que ahí por lo menos un centro creado, pulsa en el icono de lápiz de uno de los centros de la lista.

Al realizar esta acción se abre un formulario con los datos del centro seleccionado.
Desde aquí el usuario puede cambiar los campos que quiera.
Una vez realizados los cambios debe pulsar sobre <<Modificar>>.

Una vez modificados los campos y pulsada la opción indicada anteriormente, el servidor recogerá los datos. 
Si todo está bien, las modificaciones se almacenarán en la base de datos y el usuario será redirigido a la ventana principal de los centros.
En caso contrario, se recargará la página del formulario indicando los campos que tienen errores y qué errores son.

\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{../img/Anexos/Diagramas secuencia/DS - modificar centro.pdf}
	\caption{\textit{Diagrama de secuencia referente a la modificación de centros.}}\label{DS-modificarCentro}
\end{figure}

\item \textbf{Eliminación de centro}

El diagrama~\ref{DS-eliminarCentro} muestra al secuencia de pasos que se siguen para eliminar un centro de la aplicación.

Partiendo de la base de que existe al menos un centro creado y que el usuario se encuentra en la ventana de centros, el usuario pulsar sobre el icono de una papelera de un centro de la tabla.
Al realizar esta acción aparece una ventana de confirmación para afirmar que se quiere eliminar el centro. 
Al pulsar en aceptar se manda al servidor la petición de eliminación.

En el servidor se comprobará si el centro existe. 
Si no existe se devolverá un error 404 mientras que si existe se comprobará si el centro tiene titulaciones que dependan de él.
En caso afirmativo se redireccionará al usuario a la ventana principal de centros indicando que no se puede eliminar el centro porque tiene titulaciones asociadas.
En caso de que el centro no tenga titulaciones asociadas, se eliminará de la base de datos y se redireccionará al usuario a la vista principal de centros indicando en un mensaje que el centro se ha eliminado correctamente.

\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{../img/Anexos/Diagramas secuencia/DS - eliminar centro.pdf}
	\caption{\textit{Diagrama de secuencia de la eliminación de centros.}}\label{DS-eliminarCentro}
\end{figure}

\item Asignar plaza a docente

En el diagrama~\ref{DS-asignarPlaza} se puede ver el conjunto de pasos seguidos para asignar una plaza a un docente.
Para este caso se supone que se tiene una plaza y un docente creados previamente.

El cliente pulsa en el icono del lápiz de una de las plazas.
Esto abre el formulario de edición de la plaza desde donde puede seleccionar el docente a través del campo de búsqueda de docentes escribiendo el nombre del mismo.
Con el docente seleccionado se pulsa en <<Modificar>>.

Si todos los campos del formulario son correctos, se comprueba si el docente tiene alguna plaza sin fecha de cese, en ese caso no se puede vincular con esta plaza y se mostrará un mensaje informando del error. 
En caso contrario, la plaza se asigna.

Finalmente, los cambios se guardan en la base de datos y se redirecciona al usuario a la vista de plazas donde se muestran los mensajes correspondientes a la correcta modificación de la plaza y, si no ha sido posible asignar la plaza por culpa de poseer alguna plaza sin fecha de cese, también se muestra en un mensaje de error.
En caso de no haber pasado la validación del formulario, se redirecciona a la ventana del formulario mostrando los errores detectados.

\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{../img/Anexos/Diagramas secuencia/DS - asignar plaza.pdf}
	\caption{\textit{Diagrama de secuencia de la asignación de una plaza a un docente.}}\label{DS-asignarPlaza}
\end{figure}

\end{itemize}



\section{Diseño arquitectónico}


