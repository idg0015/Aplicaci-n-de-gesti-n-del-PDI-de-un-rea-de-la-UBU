{% extends "base/base_template.html" %}
{% set active_page = "grupos" %}
{% block title %}Grupos{% endblock %}

{% block content %}
    <div class="container-fluid">
        <h1 class="text-center">Grupos</h1>
        <div class="mb-3">
            <div class="col-md-2"><label for="cursos"></label>
                <label for="cursos" class="form-label">Curso:</label>
                <select name="cursos" id="cursos" class="form-select">
                    <option value="0" selected>Seleccione un curso</option>
                    {% for curso in cursos %}
                        {% set ano_inicio = curso.ano_inicio | int %}
                        <option value="{{ curso.id }}">{{ curso.ano_inicio }} - {{ ano_inicio+1 }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="row">
            <div id="tablaGrupos" class="col-md-12"></div>
        </div>
    </div>

    <script>
        let info = [];
        let table = null;

        if ($("#cursos").children().length > 1) {
            $("#cursos").children()[1].selected = true;
            $.ajax({
                url: "/grupos/cursos-asignaturas",
                method: "POST",
                data: {id: $("#cursos").children()[1].value},
                success: function (data) {
                    table.updateConfig({data: data}).forceRender();
                }
            });
        }

        if (document.getElementById('tablaGrupos') != null) {
            table = new gridjs.Grid({
                columns: [
                    {
                        name: 'Id',
                        hidden: true
                    },
                    {
                        id: 'asignatura',
                        name: gridjs.html('<span title="Asignatura">Asignatura</span>'),
                    },
                    {
                        id: 'modalidad',
                        name: gridjs.html('<span title="Modalidad">Modalidad</span>'),
                    },
                    {
                        id: 'num_alumnos_previstos',
                        name: gridjs.html('<span title="Número de alumnos previstos">Nº Alumnos Previstos</span>'),
                        attributes: {style: 'text-align: center!important;'},
                    },
                    {
                        id: 'num_grupos_teoricos',
                        name: gridjs.html('<span title="Número de grupos teóricos">Nº Grupos Teóricos</span>'),
                        attributes: {style: 'text-align: center!important;'},
                    },
                    {
                        id: 'num_grupos_practicos',
                        name: gridjs.html('<span title="Número de grupos prácticos">Nº Grupos Prácticos</span>'),
                        attributes: {style: 'text-align: center!important;'},
                    },
                    {
                        name: 'Acciones',
                        formatter: (_, row) => gridjs.html(`<a type="button" class="btn btn-primary" href="/cursos/gestion/${row.cells[0].data}">Gestionar grupos</a>`)
                    },
                ],
                language: gridjs.l10n.esES,
                sort: true,
                search: true,
                pagination: {
                    limit: 7
                },
                resizable: true,
                data: [],
            }).render(document.getElementById("tablaGrupos"));
        }

        $(document).ready(function () {
            $("#cursos").change(function () {
                let id = $(this).val();
                $.ajax({
                    url: "/grupos/cursos-asignaturas",
                    method: "POST",
                    data: {id: id},
                    success: function (data) {
                        table.updateConfig({data: data}).forceRender();
                    }
                });
            });
        });
    </script>
{% endblock %}
